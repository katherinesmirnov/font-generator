include("basis.jl")
using Plots

SPACESIZE = 10
coordinates = Dict(
    'a' => ([0.0, 9.99076900899897, 10.81092788351257, 8.631761791809774, 2.7451832583788467, 0.45281373334084096, 7.895939475130908, 11.942905615148003, 10.839172140129705, 10.669423591843557, 15.367366075254779],
        [5.0, 6.222615570383965, 7.920667070412118, 9.61871857044027, 7.581056770406488, -0.9092007297342733, 0.279435320285433, 9.50551513710506, 6.05281042038115, -2.5506505130948205, 5.0]),
    'b' => ([0.0, 12.170093138449687, 1.6134981963226367, 5.9830225738594045, 6.24695357652941, 7.331416740833502, 16.803607169990386, 11.349033114810261, 7.126137072090164, 8.005907080990184, 17.624725844963738],
        [5.0, 14.794201313886658, 15.732622656713346, -0.5718616615610966, -0.33725632585442433, 9.984791931899881, 7.052166584232552, -2.7953337307210813, 0.659229837559665, 3.0645210418923208, 5.0]),
    'c' => ([0.0, 1.9931764471291633, 6.483015478553037, 9.62573441053732, 10.636635785158445, 5.781390426761583, 0.5613000414331634, 7.184640530344492, 13.49926599646758],      
        [5.0, 4.363883302126272, 11.043353795180916, 6.552897333711466, 5.710947271561721, 11.548523832470764, 0.996083053527292, -1.2491171122053615, 5.0]),
    'd' => ([0.0, 5.268104966463091, 9.405665283043618, 6.405059921061486, -0.03496529844997627, 4.772763238421761, 7.540849365711549, 12.756506384499676, 15.437179265664524, 6.899818894128651, 8.997736801127227, 11.998924918083524, 13.892878584123906],
        [5.0, 5.85699530154838, 5.44906681963199, 9.470076141379263, 3.7008018971331773, -1.8936458548630264, 3.875628389383058, 11.975922530294229, 16.6379623236244, 11.451443053544583, -0.32020742461409407, -0.32020742461409407, 5.0]),
    'e' => ([0.0, 5.095189989345933, 7.4161347038719745, 7.931900195988872, 6.441910996540056, 1.5988730255623833, 2.946167105525525, 8.361704772752955, 9.16916430430041, 10.223618199294956],
        [5.0, 6.285009632238032, 6.57154601674742, 8.118785185821212, 9.666138969448808, 6.972696955060563, -2.3053511753534126, 3.0763751985019083, 3.878104002359175, 5.0]),
    'f' => ([0.0, 7.125110547385703, 9.589723723574402, 8.777035272424028, 5.98734671577518, 4.632865963857892, 3.847267127745865, 5.283016724778191, 7.585634003037581, 6.312422096235331, 4.226521738282706, 8.533770529379682, 9.508454878459364],
        [5.0, 7.768384483336062, 11.398392898474393, 13.890637482002203, 11.019138287937553, 6.847283392802227, -1.0081089967872006, -2.791147458611119, 0.5089094453601621, 4.57180990881126, 5.059422979501484, 4.084196838121037, 5.0]),
    'g' => ([0.0, 1.0361970981695787, 8.64897091665045, 9.544657225170887, 2.2677657723851765, -0.19593137998884497, 7.305441453869799, 8.64897091665045, 8.816912099498033, 7.921225790977598, 7.165490468163481, 2.5191177427137235, 1.6239912381361137, 4.851260968523807, 9.811459784321412, 13.32333383924147, 14.17815445993566],
        [5.0, 6.92936141863016, 7.153282995760268, 6.145635898674779, 8.27289088141081, -2.8106673825867468, 3.682498550243581, 6.369557475804887, 6.145635898674779, 0.1557337104443679, -6.449393010951015, -9.192992134737672, -4.322138028214981, -3.0149958217179718, -1.0648628064918535, 0.37965528757447764, 5.0]),
    'h' => ([0.0, 2.2716268143556206, 9.912484534557427, 11.839994305126266, 9.396205713112966, 6.505113150200187, 5.432216922062408, 5.1194207934432585, 6.195345857333511, 6.195345857333511, 6.918136207355755, 9.602786078866943, 11.896440789604194, 11.04836677891143, 11.667901364644779, 13.595342298037428, 16.43212232893425, 17.370373040439315],    
        [5.0, 5.308761217282238, 12.054804484156506, 14.53294282708991, 15.42782611759364, 13.431548008008397, 8.435689945830847, 3.743748016543601, -0.19821287812532773, -0.19821287812532773, 5.65294709824521, 6.823179093519319, 5.516236466326719, 3.1059715791192115, -0.06053852574013845, -0.06053852574013845, 4.004434402784956, 5.0]),
    'i' => ([0.0, 3.8255845443544363, 8.707911119552145, 8.872220186986684, 5.257420703426841, 5.820766077488115, 8.14456574549087, 9.27125649361342, 12.32271060311199],
        [5.0, 3.4112373465725985, 9.326363774215977, 9.373309222054418, 1.3925830895196996, -0.6725471608932548, 1.2991616483212047, 3.8337463771185543, 5.0]),
    'j' => ([0.0, 2.556374419838427, 5.086318436641675, 5.220892790181285, 3.4714800239077737, 2.879352868333491, 0.40372306061882934, -0.37734648732506587, 2.3948851955908954, 5.387818818311818, 8.647747958455325, 9.177970911401388],
        [5.0, 3.912017614095017, 8.972551604598504, 9.779997725836163, -0.8244613330850878, -4.377224266530786, -7.014343298492979, -3.4615803650472814, 1.4901637180547844, 0.4728354350367505, 2.3594602121792487, 5.0]),
    'k' => ([0.0, 2.3945349455683322, 6.6748138769656995, 7.088826842275532, 5.456551278833234, 3.7578547733799534, 3.517910483685108, 3.2397932388115374, 3.5124572043738618, 3.921453152717348, 4.521313876954462, 7.274674601202812, 9.128735034233504, 6.811145859746861, 2.8853300835805156, 6.456682704515839, 6.811145859746861, 8.719739085890017, 10.601174981063167],
        [5.0, 7.396951655317837, 12.03223906987735, 15.19023311902019, 15.036995970374164, 12.741165380339394, 8.966132777129014, 0.03502458513508033, -0.5593828597907866, 5.324705517044173, 7.451484448430302, 8.051290639874303, 6.7970909310807235, 3.253004706701632, 4.234594982726, 5.433771103269102, -0.5593828597907866, -0.3957844804533916, 5.0]),     
    'l' => ([0.0, 3.098169912266479, 4.965773787024581, 5.746109667842729, 3.9494454186135495, 2.535382216403693, 1.6505286206395988, 2.137174451768008, 3.594747290968937, 4.729308368594839, 5.485997707570013, 7.661479557123639],
        [5.0, 6.739968062939421, 11.043638678360725, 13.171827444228402, 15.914826298013411, 13.168989859207246, 6.2669899329962515, 1.4005789147958483, -0.4911444326420878, 0.6869262819748873, 4.092028307363171, 5.0]),
    'm' => ([0.0, 3.8929605883259195, 5.951755032795753, 5.247442393022765, 3.9914032698697937, 2.989077785059442, 3.7408218986672055, 5.08008983439818, 5.034000760766276, 5.77276833907962, 8.591361298374444, 9.262561399809947, 8.889374143411807, 8.6813021119668, 8.972155489255519, 9.799521480958349, 12.260588519555196, 13.2002686615649, 12.819921937418115, 12.730428590560049, 12.976535294419733, 16.005437618831014, 17.45120263732309],
        [5.0, 5.455596494341508, 7.960962739633098, 8.991612868724026, 9.117172034365897, 7.526427793963752, 2.838363565477335, 0.28690824655384134, 0.0005295366080262759, 6.394829169616923, 9.079584828685507, 7.334509311626627, 4.177631501208309, 0.22426290375319408, 0.4479962708983619, 7.021282597623393, 8.408384727250004, 7.513496005342761, 4.829143066335038, 2.5023160480252926, -1.5208573599791142, 1.9590914325968256, 5.0]),
    'n' => ([0.0, 1.930100600356711, 3.7439300802100055, 8.534300244950758, 3.7439300802100055, 4.39551343951115, 3.1393202535922407, 3.7909036128933855, 4.7443268010213995, 7.092538350708395, 10.882930370671565, 10.720197310414985, 10.157445087178449, 9.883045242790386, 10.9759937755225, 12.138704980556664, 13.836263339906541],
        [5.0, 5.5958489609152595, 6.5260179249425905, 8.851440335010917, 9.409541713427314, 5.223781375304327, -0.6358180135858409, 0.24784250224012322, 4.851713789693395, 7.130581243112155, 9.316524817024582, 6.991102406956256, 3.294331893222436, 0.8059438806565216, -0.3567673243776415, 0.9919776734619877, 5.0]),
    'o' => ([0.0, 3.2811780404451714, 5.9146722399849105, 7.354969870907345, 5.892167589501748, 4.024281599399215, 4.834449016793085, 7.5350070747726505, 11.239002488495489, 12.95817774820528, 12.080496379361922, 8.614780204954814, 7.444538379830335, 7.894631389493595, 10.842740602787954, 13.386216200395042, 15.19694037827034],
        [5.0, 6.8450754826569264, 6.7104976727676116, 7.115581381464547, 8.10578600272372, 4.910125634114569, 0.6797014362895796, -0.44553108786857276, 1.1671521657548911, 4.595015518049319, 8.285823206589026, 9.456065031713504, 7.835730196925765, 5.675283750542112, 6.620028977825296, 7.904144334394581, 5.0]),
    'p' => ([0.0, 3.7757753067672732, 6.372690733416544, 6.805186108586994, 4.900966526722916, 3.818802767069853, 3.818802767069853, 4.554896200848401, 7.004685472914656, 7.004685472914656, 5.01570642086313, 7.744942854464422, 10.428329596495976, 11.261165416825808, 10.567174121622902, 7.305415034169248, 6.4962211839626605, 10.12764630132773, 13.296873216087663],
        [5.0, 5.484702650794466, 7.9084441162474395, 8.903627633568403, 9.163643038837762, 7.951471576550018, 3.8832020718978946, 0.3777132415689808, -6.4266400774637695, -6.236949123441642, 3.705632832498644, 9.211297107775025, 8.841168417000143, 5.972671063494801, 1.392791176019097, -0.13398967342729495, 1.9937876376648127, 3.8906971778860857, 5.0]),  
    'q' => ([0.0, 1.5896185111639973, 1.8137890940608319, 7.467371194718997, 9.833566420722716, 9.639285248878794, 7.890804517968574, 5.400020263559302, 2.9844576936331895, 1.8636047791490171, 4.802730199351958, 6.84467513111668, 9.559629968422785, 9.733984866231435, 6.630716763662923, 5.599283003912044, 5.698665295662974, 6.446149650411196, 8.239514313585872, 8.388961368850428, 7.093753556557607, 7.1684770841898855, 9.285643700437767, 11.502441686862019],
        [5.0, 5.55661748535063, 7.150719408172565, 9.392425237140909, 8.645189960818128, 8.475318474667414, 8.645189960818128, 7.74850762923079, 6.851825297643451, 3.514174396735026, 2.4680450098831326, 3.7134371370877695, 8.445927220465386, 8.695005645906313, 2.378028066928781, -3.011182192966384, -5.168699514135696, -6.7428751629223544, -3.3100763034954963, -0.2713195131161843, 2.1691508993540207, 2.3185979546185767, 1.3222842528548675, 5.0]),
    'r' => ([0.0, 2.9341554298204415, 5.520290570822025, 5.901844064553116, 4.757183583359845, 4.163555226129763, 6.537615503632357, 10.689841944318799, 10.055384644350983, 7.336974604513169, 7.495124449301946, 8.945208986047184, 11.031064961871662, 12.853639963993333],
        [5.0, 4.995257264233482, 7.28421570548584, 8.640951050178103, 9.234579407408184, 8.386733104829954, 7.496290568984831, 7.955332955148246, 8.1365935222414, 3.4238187778193776, -0.2009394126259833, -0.06499398730611736, 1.7734413144362042, 5.0]),
    's' => ([0.0, 6.016247629684133, 10.312882123835669, 6.995171983221868, 8.23095905198351, 7.221295914130931, 6.455544430230466, 1.7987585099713375, 3.61790294972235, 7.394896096548832, 10.912468293826114],
        [5.0, 4.846180510051402, 8.843421643321042, 9.52295263597688, 4.761119218735424, 2.367851035012894, 1.2490632142220548, 0.249752930904645, 1.6084151921029952, -1.4290883450686034, 5.0]),
    't' => ([0.0, 2.9566564843029473, 7.913410291539431, 9.954321644721153, 9.857270287447191, 6.932089919016881, 5.067130053563195, 5.312643757369756, 7.373804745096208, 9.673659611523481, 11.790585784537619],
        [5.0, 6.8619357057243935, 11.229771384983858, 15.188942159830264, 15.262386430199747, 7.745312897689925, 2.445312046862344, -0.1556643280798149, -0.20287850188876982, 5.033173373524238, 5.0]),
    'u' => ([0.0, 3.674453242991019, 6.307811400467917, 6.185329625701549, 4.142333622598541, 3.455210866159222, 5.231196600271548, 10.387128149949163, 11.819491264954445, 11.819491264954445, 9.642316477594884, 9.21675355116914, 10.135366861916895, 14.78967430303885],
        [5.0, 4.366791087821141, 9.143641544596848, 9.388605094129584, 3.3850384221813234, -0.05247382752415797, -0.3389586987026911, 5.676794909834823, 8.592473558148196, 8.898677995064116, 3.3850384221813234, -0.16497333764706631, -0.3486959997966173, 5.0]),
    'v' => ([0.0, 4.080966531945987, 4.926845398559743, 4.727877665154998, 6.011591945116629, 6.19779169562909, 9.49618727613556, 9.043987882033866, 11.996583925874333],
        [5.0, 8.979725145618914, 9.577160345120328, 6.093522612818318, -0.43293824242962614, -0.1669385988403948, 8.345049996015009, 9.089848998064856, 5.0]),
    'w' => ([0.0, 6.653287481642804, 7.07854795459607, 5.767813620151073, 2.883615535778993, 3.6997661146934115, 5.9449083924494195, 10.194600379016643, 10.398492386596976, 8.534336888719647, 8.451323714204797, 9.868314912028803, 11.9937434539055, 15.69968458368563, 14.534587397512299, 16.07834116919196, 18.787192127044957],
            [5.0, 9.074497113555202, 9.235863073840209, 7.662981872506212, 2.0705153788742257, -0.14258672626201577, 0.24597318532678994, 7.54647215388888, 7.662981872506212, 3.1191028464302235, 0.028100011512377128, -0.08083657539482925, 0.4636715945632768, 8.187275606284212, 9.527137370383542, 4.983258344307552, 5.0]),
    'x' => ([0.0, 5.147221840323665, 4.00547067590422, 4.275650519630021, 5.624681418171797, 7.74211085036786, 9.299044256394378],
            [5.0, 9.674859243417146, 9.052085881006537, 4.859575605258331, -2.20973242258527, 1.9431279490894597, 5.0]),
    'y' => ([0.0, 3.126895624319092, 7.3970454079660195, 7.876448166424017, 5.811769354100931, 4.885433346721933, 6.848610835114242, 10.899659642641778, 12.147280082624244, 12.531184283620489, 9.939899140151166, 6.197856379267729, 2.263315811843531, 1.2551238980687456, 1.5429838355605996, 4.661693869240112, 7.732654624188751, 11.763375881627997, 15.12233300057915],
            [5.0, 4.310599859566134, 7.429719172777627, 8.14950544301792, 5.358355461432218, 2.425185482249823, 2.0159059502708843, 4.838434029308306, 7.861509079015406, 8.533409644014164, 2.0551967853408613, -4.9500316840106535, -7.349774006513832, -6.774054131530125, -4.4220610877578235, -2.0235466038505825, -0.9198561326140444, -0.10416202538001951, 5.0]),
    'z' => ([0.0, 1.2711459901409983, 2.485796602942398, 5.395308535931796, 7.739866695525193, 5.453216297704885, 4.208905611800196, 2.5846635132866975, 5.960262309327795, 7.487049881930484, 8.728535798968192, 8.276572780251392, 7.345811438581483, 4.223029456135096, 2.6835304236309976, 1.638365942848399, 3.6157041497343965, 5.594454741053886, 18.021884132889035],
            [5.0, 3.1121967906416064, 6.643157874366603, 8.7617345246016, 6.290061765994103, 3.8890082290611065, 2.6884814605946072, 1.725800230727824, 3.8890082290611065, 2.6884814605946072, 1.1348585837556069, -0.7718604014558901, -3.596629268435888, -6.520265045760186, -7.480686460533385, -5.0796329236003865, -3.7364553273513983, -2.607960164992888, 5.0])
)

charAdditions = Dict(
    'i' => ([9.0, 8.953, 8.959, 9.032, 9.048, 9.008000000000001],
            [12.765, 12.735, 12.6799, 12.6799, 12.735, 12.75]),
    'j' => ([6.0, 5.953, 5.959, 6.032, 6.048, 6.008000000000001],
            [12.765, 12.735, 12.6799, 12.6799, 12.735, 12.75]),
    't' => ([3.0, 5.381, 6.801, 6.941000000000001, 8.521, 9.5799],
            [7.0, 7.0, 7.0, 7.0, 7.0, 7.0]),
    'x' => ([0.0, 0.8800000000000001, 2.3198999999999996, 2.92, 2.92, 4.1598999999999995, 6],
            [0.85, 2.1, 3.85, 4.45, 4.45, 6.1, 7.5]),
    
)


"""
    Draws a curve of degree "k"-1, with "N" points stored in "x_pts", "y_pts"
"""
function graph(k, (x_pts, y_pts))
    @assert length(x_pts) == length(y_pts)
    
    N = length(x_pts)
    X = Matrix{Float64}(undef, N, N)
    Y = Matrix{Float64}(undef, N, N)

    X .= x_pts
    Y .= y_pts

    knots = 0 :1 : k+1
    B = bspline(knots, 1, k)
    
    Bx = add_control_pts(X, B, N, k)
    By = add_control_pts(Y, B, N, k)

    x = 0:0.0001:1

    plot!(Bx.(x), By.(x), legend=false, aspect_ratio = :equal, c=:blue)
    #scatter!(X, Y)
end

"""
    Creates a graph of a given "word", starting at x value: "startingOffset"
    Returns the last x coordinate of the word
    Note: does not create graph, 
        To do so: intialiaze a plot and use display()
"""
function writeWord(word, startingOffset)
    coords_x, coords_y = [], []
    offset = startingOffset

    # graphs letter by letter
    for i in 1:1:length(word)
        char = word[i]

        if i == 1
            #initialize array
            starting_char = word[1]
            coords_x = copy(map((item) -> item + startingOffset, coordinates[starting_char][1]))
            coords_y = copy(coordinates[starting_char][2])
        else
            # offsets by last character
            offset = coords_x[end][1]
            append!(coords_x, map((item) -> item + offset, coordinates[char][1]))
            append!(coords_y, coordinates[char][2])
        end
        
        # Check if has extra details
        if haskey(charAdditions, char)
            newX = []
            append!(newX, map((item) -> item + offset, charAdditions[char][1]))
            graph(3, (newX, charAdditions[char][2]))
        end    
    end

    # Graphing the data
    graph(3, (coords_x, coords_y))

    return coords_x[end]

end

"""
    Creates a graph of a given "sentence"
    Note: calls writeWord()
"""
function writeSentence(str)
    p = plot(title= "B-spline representation")
    
    print("Creating graph...")

    words = split(str, " ")
    prevoffSet = writeWord(words[1], 0)
    for word in words[2:end]
        prevoffSet = writeWord(word, prevoffSet + SPACESIZE)
    end
    display(p)
    print("Done\n")
end

function runByInput()
    print("Provide a sentence: ")
    input = readline()
    println()

    writeSentence(input)

    println("\n(^C to close program)")
    readline()
end

function writealpha()
    str = ""
    for key in sort(collect(keys(coordinates)))
        str *= key
    end

    writeSentence(str)    
end

runByInput()
# writeSentence("this is a sentence")
# writealpha()